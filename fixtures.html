<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nepal Premier League</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="shortcut icon" type="image/png" href="assets/NPLLogo.jpg">
<link rel="stylesheet" href="style.css">

<style>
.main-content {
    width: 90%;
    max-width: 1100px;
    margin: 20px auto;
    padding: 0 16px;
    font-family: Arial, sans-serif;
    margin-top: 150px;
}

/* Upcoming match card background and padding */
.upcoming-card {
    background-color: #bbe2ff; /* light blue */
    border-radius: 20px;
    border-left: 8px solid #1a73e8;
    border-right: 8px solid #1a73e8;
    padding: 35px 19px 19px 19px; /* <-- increase top padding for badge */
    margin-bottom: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    position: relative; /* needed for badge positioning */
}

/* Upcoming badge on top-left */
.upcoming-badge {
    background: #1a73e8;
    color: white;
    padding: 3px 10px;
    font-size: 15px;
    font-weight: bold;
    border-radius: 5px;
    position: absolute;
    top: 12px;
    left: 12px;
    z-index: 10;
}

.live-card {
    background-color: #ffffff; /* light blue */
    border-radius: 20px;
    border-left: 8px solid #1a73e8;
    border-right: 8px solid #1a73e8;
    padding: 35px 19px 19px 19px; /* <-- increase top padding for badge */
    margin-bottom: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    position: relative;
}

/* LIVE BADGE */
.live-badge {
    background: red;
    animation: pulse 0.8s infinite alternate; /* <-- animation applied */
    color: white;
    padding: 3px 10px;
    font-size: 15px;
    font-weight: bold;
    border-radius: 5px;
    position: absolute; /* <-- you forgot this */
    top: 12px;
    left: 12px;
    z-index: 10;
}

/* ANIMATION KEYFRAMES */
@keyframes pulse {
    100% { 
        opacity: 0.4;
    }
}



@media (max-width: 768px) {
    .upcoming-highlight{
        max-width: 320px;
    }
}

</style>
</head>

<body>
<header class="header">
    <div class="logo">
        <a href="index.html"><img src="assets/NPLLogo.jpg" alt="Logo"></a>
    </div>
    <div class="follow-us">
        <h4>Follow us</h4>
        <a href="#"><i class="fa-brands fa-instagram"></i></a>
        <a href="#"><i class="fa-brands fa-youtube"></i></a>
        <a href="#"><i class="fa-brands fa-facebook"></i></a>
    </div>
</header>

<nav class="navbar">
<ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="fixtures.html" id="fixtureNav">Fixtures</a></li>
    <li><a href="pointstable.html">Points Table</a></li>
    <li><a href="teams.html">Teams</a></li>
    <li><a href="stats.html">Stats</a></li>
</ul>
</nav>

<main class="main-content">
<section class="fixture-section">
    <h1 class="fixture-title">Nepal Premier League 2025 Fixtures</h1>

    <div id="fixture-list" class="fixture-list"></div>
    <p id="fixture-loading" class="fixture-message">Loading fixtures...</p>
    <p id="fixture-error" class="points-message error-message" style="display:none;">Could not load fixtures.</p>
</section>
</main>

<footer class="footer">
          <div class="footer-container">
           <div class="footer-col">
            <h3 class="footer-title">Nepal Premier League</h3>
            <p class="footer-text">
                Hub for Nepal Premier League 2025 | fixtures, points table,
                stats and team details. Built with passion for Nepali cricket.
            </p>
          </div>

        <div class="footer-col">
            <h4 class="footer-title">Quick Links</h4>
            <ul class="footer-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="fixtures.html">Fixtures</a></li>
                <li><a href="pointstable.html">Points Table</a></li>
                <li><a href="teams.html">Teams</a></li>
                <li><a href="stats.html">Stats</a></li>
            </ul>
        </div>

        <div class="footer-col">
            <h4 class="footer-title">Stay Connected</h4>
            <p class="footer-text">Follow official NPL accounts for live updates:</p>
            <div class="footer-social">
                <a href="https://www.instagram.com/officialnplt20/profilecard/?igsh=MWQ4YmhiY3pjMWt4YQ==" target="_blank" aria-label="Instagram">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href="https://youtube.com/@officialnplt20?si=GuzBCHmQbulXNwYh" target="_blank" aria-label="YouTube">
                    <i class="fa-brands fa-youtube"></i>
                </a>
                <a href="https://www.facebook.com/OfficialNPLT20?mibextid=LQQJ4d" target="_blank" aria-label="Facebook">
                    <i class="fa-brands fa-facebook"></i>
                </a>
            </div>
            <p class="footer-text small">
                Designed & developed by <strong>ERAA4IT</strong>.
            </p>
          </div>
        </div>

       <div class="footer-bottom">
        <span>&copy; 2025 Nepal Premier League. All rights reserved.</span>
       </div>
</footer>

<button id="backToTopBtn">⬆</button>

<!-- CHAT BUTTON -->
<div id="chatBox" class="chat-popup">
    <div class="chat-header">Support Chat</div>
    <p>Hello! How can we help you?</p>
</div>
<div class="chat-button" onclick="toggleChat()">
    <i class="fa-solid fa-message"></i>
</div>

<script>
function toggleChat() {
    const box = document.getElementById("chatBox");
    box.style.display = (box.style.display === "block") ? "none" : "block";
}

document.addEventListener("DOMContentLoaded", function() {
    const backToTopBtn = document.getElementById("backToTopBtn");

    window.addEventListener("scroll", function () {
        if (window.scrollY > 200) {
            backToTopBtn.style.display = "block";
        } else {
            backToTopBtn.style.display = "none";
        }
    });

    backToTopBtn.addEventListener("click", function () {
        window.scrollTo({ top: 0, behavior: "smooth" });
    });
});
</script>

<!-- ===================== FIXTURES SCRIPT ==================== -->
<script>
function parseNepal12HourTime(dateStr, timeStr) {
    const [_, day, monthName, year] =
        dateStr.replace(',', '').split(' ');

    const months = {
        Jan: 0, Feb: 1, Mar: 2, Apr: 3, May: 4, Jun: 5,
        Jul: 6, Aug: 7, Sep: 8, Oct: 9, Nov: 10, Dec: 11
    };

    let [hm, modifier] = timeStr.split(" ");
    let [hours, minutes] = hm.split(":").map(Number);

    if (modifier === "PM" && hours !== 12) hours += 12;
    if (modifier === "AM" && hours === 12) hours = 0;

    // Build a Date in Nepal Time using ISO → ALWAYS SAFE
    // YYYY-MM-DDTHH:mm+05:45
    const iso = `${year}-${String(months[monthName] + 1).padStart(2, "0")}-${String(day).padStart(2,"0")}T${String(hours).padStart(2,"0")}:${String(minutes).padStart(2,"0")}:00+05:45`;

    return new Date(iso); // Auto converts to local timezone correctly
}

async function loadfixtureTable() {
    const list = document.getElementById("fixture-list");
    const loadingMsg = document.getElementById("fixture-loading");
    const errorMsg = document.getElementById("fixture-error");

    loadingMsg.style.display = "block";
    errorMsg.style.display = "none";
    list.innerHTML = "";

    try {
        const response = await fetch("data/npl2025-fixtures.json");
        if(!response.ok) throw new Error("Network error");

        const data = await response.json();
        loadingMsg.style.display = "none";

        const fixtures = data.fixtures || [];
        const links = data.links || {};

        const now = new Date();
        window._upcomingAssigned = false;

        fixtures.forEach(match => {
            const card = document.createElement("div");

            const dateObj = parseNepal12HourTime(match.date, match.time);

            // =====================
            // LIVE MATCH LOGIC (4 HOURS)
            // =====================
            const fourHoursAfter = new Date(dateObj.getTime() + 4 * 60 * 60 * 1000);
            const isLiveMatch = now >= dateObj && now <= fourHoursAfter;

            const isUpcoming = dateObj > now && !window._upcomingAssigned;

            card.className = "fixture-card";

            if (isLiveMatch) {
                card.id = "liveMatch";
                card.classList.add("live-card");
            }

            if (isUpcoming) {
                window._upcomingAssigned = true;
                card.id = "upcomingMatch";
                card.classList.add("upcoming-card");
            }

            const localDate = dateObj.toLocaleDateString(undefined, { weekday:'short', day:'numeric', month:'short', year:'numeric' });
            const localTime = dateObj.toLocaleTimeString(undefined, { hour:'2-digit', minute:'2-digit', hour12:true });

            let colorA = "black";
            let colorB = "black";

            const runsA = match.scorea ? parseInt(match.scorea.split('/')[0], 10) : NaN;
            const runsB = match.scoreb ? parseInt(match.scoreb.split('/')[0], 10) : NaN;

            if (!isNaN(runsA) && !isNaN(runsB)) {
                if (runsA > runsB) {
                    colorB = "rgb(164,160,175)";
                } else if (runsB > runsA) {
                    colorA = "rgb(164,160,175)";
                }
            }

            const teamaLink = links[match.teama] || "#";
            const teambLink = links[match.teamb] || "#";

            card.innerHTML = `
                ${isLiveMatch ? `<span class="badge live-badge">LIVE</span>` : ""}
                ${isUpcoming ? `<span class="badge upcoming-badge">Upcoming Match</span>` : ""}

                <div class="fixture-date-time">
                    <span>${localDate}</span>
                    <span style="color: #808080;">${localTime} | Local ${match.time}</span>
                </div>

                <div class="fixture-match">${match.match}</div>

                <div class="fixture-teams">
                    <div class="team-block">
                        <a href="${teamaLink}" target="_blank" style="color:${colorA}; text-decoration: none;">${match.teama}</a>
                        <span class="team-score" style="color:${colorA}">${match.scorea || "-"}</span>
                    </div>
                    <span class="fixture-vs">vs</span>
                    <div class="team-block">
                        <a href="${teambLink}" target="_blank" style="color:${colorB}; text-decoration: none;">${match.teamb}</a>
                        <span class="team-score" style="color:${colorB}">${match.scoreb || "-"}</span>
                    </div>
                </div>

                <div class="fixture-result">${match.result || ""}</div>
            `;


            list.appendChild(card);
        });

        setTimeout(() => {
            const live = document.getElementById("liveMatch");

            if (live) {
                const y = live.getBoundingClientRect().top + window.pageYOffset - 120; 
                window.scrollTo({ top: y, behavior: "smooth" });
            } else {
                const up = document.getElementById("upcomingMatch");
                if (up) {
                const y2 = up.getBoundingClientRect().top + window.pageYOffset - 120;
                window.scrollTo({ top: y2, behavior: "smooth" });
                }
            }
        }, 400);



    } catch(err) {
        console.error("Failed to load fixtures:", err);
        loadingMsg.style.display = "none";
        errorMsg.style.display = "block";
    }
}

document.addEventListener("DOMContentLoaded", loadfixtureTable);
</script>

<!-- NAVBAR SCROLL -->
<script>
const live = document.getElementById("liveMatch");
if (live) {
    live.scrollIntoView({ behavior: "smooth", block: "start" });
} else {
    const up = document.getElementById("upcomingMatch");
    if (up) up.scrollIntoView({ behavior: "smooth", block: "start" });
}

</script>

</body>
</html>
