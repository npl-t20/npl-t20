<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nepal Premier League</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="shortcut icon" type="image/png" href="assets/NPLLogo.jpg">
<link rel="stylesheet" href="style.css">

<style>
.main-content {
    width: 90%;
    max-width: 1100px;
    margin: 20px auto;
    padding: 0 16px;
    font-family: Arial, sans-serif;
    margin-top: 150px;
}

.upcoming-highlight {
    width: 100%;
    max-width: 750px;
    background: #e6f0ff;
    border-left: 10px solid #1a73e8;
    border-right: 10px solid #1a73e8;
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    margin-bottom: 25px;
    scroll-margin-top: 160px;
}
.upcoming-title {
    font-size: 20px;
    font-weight: bold;
    color: #1a73e8;
    margin-bottom: 10px;
}
@media (max-width: 768px) {
    .upcoming-highlight{
        max-width: 320px;
    }
}

</style>
</head>

<body>
<header class="header">
    <div class="logo">
        <a href="index.html"><img src="assets/NPLLogo.jpg" alt="Logo"></a>
    </div>
    <div class="follow-us">
        <h4>Follow us</h4>
        <a href="#"><i class="fa-brands fa-instagram"></i></a>
        <a href="#"><i class="fa-brands fa-youtube"></i></a>
        <a href="#"><i class="fa-brands fa-facebook"></i></a>
    </div>
</header>

<nav class="navbar">
<ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="fixtures.html" id="fixtureNav">Fixtures</a></li>
    <li><a href="pointstable.html">Points Table</a></li>
    <li><a href="teams.html">Teams</a></li>
    <li><a href="stats.html">Stats</a></li>
</ul>
</nav>

<main class="main-content">
<section class="fixture-section">
    <h1 class="fixture-title">Nepal Premier League 2025 Fixtures</h1>

    <div id="fixture-list" class="fixture-list"></div>
    <p id="fixture-loading" class="fixture-message">Loading fixtures...</p>
    <p id="fixture-error" class="points-message error-message" style="display:none;">Could not load fixtures.</p>
</section>
</main>

<footer class="footer">
    <!-- Footer unchanged -->
</footer>

<button id="backToTopBtn">â¬†</button>

<!-- CHAT BUTTON -->
<div id="chatBox" class="chat-popup">
    <div class="chat-header">Support Chat</div>
    <p>Hello! How can we help you?</p>
</div>
<div class="chat-button" onclick="toggleChat()">
    <i class="fa-solid fa-message"></i>
</div>

<script>
function toggleChat() {
    const box = document.getElementById("chatBox");
    box.style.display = (box.style.display === "block") ? "none" : "block";
}
</script>

<!-- ===================== FIXTURES SCRIPT ==================== -->
<script>
function parseNepal12HourTime(dateStr, timeStr) {
    // dateStr format expected similar to: "Wed, 21 Jan 2025" (weekday day mon year)
    let [time, modifier] = timeStr.split(' ');
    let [hours, minutes] = time.split(':').map(Number);

    if(modifier === "PM" && hours < 12) hours += 12;
    if(modifier === "AM" && hours === 12) hours = 0;

    const [weekday, day, month, year] = dateStr.split(/,?\s+/);
    const months = {Jan:0, Feb:1, Mar:2, Apr:3, May:4, Jun:5, Jul:6, Aug:7, Sep:8, Oct:9, Nov:10, Dec:11};

    return new Date(Date.UTC(
        Number(year),
        months[month],
        Number(day),
        hours - 5,
        minutes - 45
    ));
}

async function loadfixtureTable() {
    const list = document.getElementById("fixture-list");
    const loadingMsg = document.getElementById("fixture-loading");
    const errorMsg = document.getElementById("fixture-error");

    loadingMsg.style.display = "block";
    errorMsg.style.display = "none";
    list.innerHTML = "";

    try {
        const response = await fetch("data/npl2025-fixtures.json");
        if(!response.ok) throw new Error("Network error");

        const data = await response.json();
        loadingMsg.style.display = "none";

        const fixtures = data.fixtures || [];
        const links = data.links || {};

        const now = new Date();
        window._upcomingAssigned = false;

        fixtures.forEach(match => {
            const card = document.createElement("div");

            const dateObj = parseNepal12HourTime(match.date, match.time);
            const isUpcoming = dateObj > now && !window._upcomingAssigned;

            card.className = isUpcoming ? "fixture-card upcoming-highlight" : "fixture-card";

            if (isUpcoming) {
                window._upcomingAssigned = true;
                card.id = "upcomingMatch";
            }

            const localDate = dateObj.toLocaleDateString(undefined, { weekday:'short', day:'numeric', month:'short', year:'numeric' });
            const localTime = dateObj.toLocaleTimeString(undefined, { hour:'2-digit', minute:'2-digit', hour12:true });

            // --- Robust color logic & safe parsing ---
            let colorA = "black";
            let colorB = "black";

            // Try to extract runs (before '/'), guard against '-' or missing
            const runsA = match.scorea && typeof match.scorea === "string"
                ? parseInt(match.scorea.split('/')[0], 10)
                : NaN;
            const runsB = match.scoreb && typeof match.scoreb === "string"
                ? parseInt(match.scoreb.split('/')[0], 10)
                : NaN;

            // If both runs are valid numbers, decide winner/loser
            if (!isNaN(runsA) && !isNaN(runsB)) {
                if (runsA > runsB) {
                    colorA = "black";           // winner stays black
                    colorB = "rgb(164,160,175)"; // loser grey
                } else if (runsB > runsA) {
                    colorB = "black";
                    colorA = "rgb(164,160,175)";
                } else {
                    // tie - keep both same color (black)
                    colorA = "black";
                    colorB = "black";
                }
            } else {
                // If either score missing/invalid, keep default colors
                colorA = "black";
                colorB = "black";
            }

            const teamaLink = links[match.teama] || "#";
            const teambLink = links[match.teamb] || "#";

            card.innerHTML = `
                ${isUpcoming ? `<div class="upcoming-title">Upcoming Match</div>` : ""}
                <div class="fixture-date-time">
                    <span>${localDate}</span>
                    <span>${localTime} | Local ${match.time}</span>
                </div>
                <div class="fixture-match">${match.match}</div>
                <div class="fixture-teams">
                    <div class="team-block">
                        <a href="${teamaLink}" target="_blank" style="color:${colorA}; text-decoration: none;">${match.teama}</a>
                        <span class="team-score" style="color:${colorA}">${match.scorea || "-"}</span>
                    </div>
                    <span class="fixture-vs">vs</span>
                    <div class="team-block">
                        <a href="${teambLink}" target="_blank" style="color:${colorB}; text-decoration: none;">${match.teamb}</a>
                        <span class="team-score" style="color:${colorB}">${match.scoreb || "-"}</span>
                    </div>
                </div>
                <div class="fixture-result">${match.result || ""}</div>
            `;

            list.appendChild(card);
        });

        // Auto scroll to upcoming match
        setTimeout(() => {
            const up = document.getElementById("upcomingMatch");
            if (up) up.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 400);

    } catch(err) {
        console.error("Failed to load fixtures:", err);
        loadingMsg.style.display = "none";
        errorMsg.style.display = "block";
    }
}

document.addEventListener("DOMContentLoaded", loadfixtureTable);
</script>

<!-- NAVBAR SMOOTH SCROLL -->
<script>
document.getElementById("fixtureNav")?.addEventListener("click", () => {
    setTimeout(() => {
        const m = document.getElementById("upcomingMatch");
        if (m) m.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 300);
});
</script>

</body>
</html>
